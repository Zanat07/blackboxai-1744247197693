<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agente de Inversiones</title>
    <!-- Production build of Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .transition-all {
            transition: all 0.3s ease;
        }
        .dashboard-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <header class="bg-indigo-600 text-white p-4 shadow-md">
        <h1 class="text-2xl font-bold">AI Assistant</h1>
    </header>

    <main id="main-container" class="flex-1 p-4 flex flex-col">
        <!-- Initial full-width chat container -->
        <div id="chat-container" class="flex-1 bg-white rounded-lg shadow-md p-4 flex flex-col transition-all">
            <div id="chat-messages" class="flex-1 overflow-y-auto mb-4 space-y-4">
                <!-- Messages will appear here -->
            </div>
            <div class="flex items-center border-t border-gray-200 pt-4">
                <input id="user-input" type="text" placeholder="Type your message..." 
                    class="flex-1 border border-gray-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <button id="send-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-r-lg hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Dashboard container (hidden initially) -->
        <div id="dashboard-container" class="hidden flex-1 bg-white rounded-lg shadow-md p-4 ml-4 transition-all">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Generated Dashboards</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="dashboard-item rounded-lg p-4 shadow-sm">
                    <h3 class="font-medium text-gray-700">Analytics Overview</h3>
                    <div class="h-40 mt-2 bg-white rounded"></div>
                </div>
                <div class="dashboard-item rounded-lg p-4 shadow-sm">
                    <h3 class="font-medium text-gray-700">Data Trends</h3>
                    <div class="h-40 mt-2 bg-white rounded"></div>
                </div>
                <div class="dashboard-item rounded-lg p-4 shadow-sm">
                    <h3 class="font-medium text-gray-700">Key Metrics</h3>
                    <div class="h-40 mt-2 bg-white rounded"></div>
                </div>
                <div class="dashboard-item rounded-lg p-4 shadow-sm">
                    <h3 class="font-medium text-gray-700">Performance</h3>
                    <div class="h-40 mt-2 bg-white rounded"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const dashboardContainer = document.getElementById('dashboard-container');
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const mainContainer = document.getElementById('main-container');

            let firstInteraction = false;
            let financialData = [];

            // Load all data from single JSON file
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    financialData = data.financial;
                    if (financialData.length > 0) {
                        console.log('All data loaded successfully from JSON');
                    }
                });

            function createChart(ctx, type, data, label) {
                return new Chart(ctx, {
                    type: type,
                    data: {
                        labels: financialData.map(item => item.Date),
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: 'rgba(79, 70, 229, 0.2)',
                            borderColor: 'rgba(79, 70, 229, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: false }
                        }
                    }
                });
            }

            function addMessage(text, isUser) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `max-w-xs md:max-w-md rounded-lg px-4 py-2 ${isUser ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-800'}`;
                messageBubble.textContent = text;
                
                messageDiv.appendChild(messageBubble);
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            async function renderDashboards() {
                // Load all data from JSON
                const data = await fetch('data.json').then(r => r.json());
                const geoDataParsed = data.geographic;
                const demoDataParsed = data.demographic;
                const productDataParsed = data.product_segments;

                const dashboardContent = document.createElement('div');
                dashboardContent.innerHTML = `
                    <h2 class="text-2xl font-bold mb-6 text-indigo-700">Comprehensive Business Dashboard</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Summary Cards -->
                        <div class="grid grid-cols-2 gap-4 col-span-2">
                            <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-indigo-500">
                                <h3 class="text-sm font-medium text-gray-500">Current Stock Price</h3>
                                <p class="text-2xl font-bold">$${financialData[financialData.length-1].StockPrice}</p>
                                <p class="text-sm ${parseFloat(financialData[financialData.length-1].StockPrice) > parseFloat(financialData[0].StockPrice) ? 'text-green-500' : 'text-red-500'}">
                                    ${((parseFloat(financialData[financialData.length-1].StockPrice) - parseFloat(financialData[0].StockPrice)) / parseFloat(financialData[0].StockPrice) * 100).toFixed(2)}% YTD
                                </p>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-blue-500">
                                <h3 class="text-sm font-medium text-gray-500">Latest Revenue</h3>
                                <p class="text-2xl font-bold">$${financialData[financialData.length-1].Revenue}B</p>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-green-500">
                                <h3 class="text-sm font-medium text-gray-500">Net Income</h3>
                                <p class="text-2xl font-bold">$${financialData[financialData.length-1].NetIncome}B</p>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-purple-500">
                                <h3 class="text-sm font-medium text-gray-500">ROI</h3>
                                <p class="text-2xl font-bold">${financialData[financialData.length-1].ROI}%</p>
                            </div>
                        </div>

                        <!-- Financial Charts -->
                        <div class="col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Stock Price History</h3>
                                <canvas id="stockChart" height="250"></canvas>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Revenue & Net Income</h3>
                                <canvas id="incomeChart" height="250"></canvas>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Return on Investment</h3>
                                <canvas id="roiChart" height="250"></canvas>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Market Capitalization</h3>
                                <canvas id="marketCapChart" height="250"></canvas>
                            </div>
                        </div>

                        <!-- Geographic Visualization -->
                        <div class="col-span-2 bg-white rounded-xl p-4 shadow-md">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800">Geographic Revenue Distribution</h3>
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-1 h-96" id="map"></div>
                                <div class="flex-1">
                                    <canvas id="geoChart" height="350"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Demographic Visualizations -->
                        <div class="col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Customer Age Distribution</h3>
                                <canvas id="ageChart" height="250"></canvas>
                            </div>
                            <div class="bg-white rounded-xl p-4 shadow-md">
                                <h3 class="text-lg font-semibold mb-3 text-gray-800">Gender Revenue Contribution</h3>
                                <canvas id="genderChart" height="250"></canvas>
                            </div>
                        </div>

                        <!-- Product Segmentation -->
                        <div class="col-span-2 bg-white rounded-xl p-4 shadow-md">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800">Product Category Performance</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <canvas id="productChart" height="300"></canvas>
                                </div>
                                <div>
                                    <canvas id="marginChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                dashboardContainer.innerHTML = '';
                dashboardContainer.appendChild(dashboardContent);

                // Render charts after a small delay to ensure DOM is ready
                setTimeout(() => {
                    if (financialData.length > 0) {
                        // Stock Price Chart
                        new Chart(document.getElementById('stockChart'), {
                            type: 'line',
                            data: {
                                labels: financialData.map(item => item.Date),
                                datasets: [{
                                    label: 'Stock Price ($)',
                                    data: financialData.map(item => item.StockPrice),
                                    borderColor: 'rgb(79, 70, 229)',
                                    backgroundColor: 'rgba(79, 70, 229, 0.1)',
                                    borderWidth: 2,
                                    tension: 0.1,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `$${context.raw}`;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Income Chart
                        new Chart(document.getElementById('incomeChart'), {
                            type: 'bar',
                            data: {
                                labels: financialData.map(item => item.Date),
                                datasets: [
                                    {
                                        label: 'Revenue ($B)',
                                        data: financialData.map(item => item.Revenue),
                                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Net Income ($B)',
                                        data: financialData.map(item => item.NetIncome),
                                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });

                        // ROI Chart
                        new Chart(document.getElementById('roiChart'), {
                            type: 'line',
                            data: {
                                labels: financialData.map(item => item.Date),
                                datasets: [{
                                    label: 'ROI (%)',
                                    data: financialData.map(item => item.ROI),
                                    borderColor: 'rgb(168, 85, 247)',
                                    backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                    borderWidth: 2,
                                    tension: 0.1,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true
                            }
                        });

                        // Market Cap Chart
                        new Chart(document.getElementById('marketCapChart'), {
                            type: 'line',
                            data: {
                                labels: financialData.map(item => item.Date),
                                datasets: [{
                                    label: 'Market Cap ($B)',
                                    data: financialData.map(item => item.MarketCap),
                                    borderColor: 'rgb(236, 72, 153)',
                                    backgroundColor: 'rgba(236, 72, 153, 0.1)',
                                    borderWidth: 2,
                                    tension: 0.1,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `$${context.raw}B`;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Initialize Map
                        const map = L.map('map').setView([20, 0], 2);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(map);

                        // Add revenue circles to map
                        geoDataParsed.forEach(loc => {
                            const country = loc.Country;
                            const revenue = parseFloat(loc.Revenue);
                            const latLng = getCountryCoordinates(country);
                            if (latLng) {
                                L.circle(latLng, {
                                    color: '#4f46e5',
                                    fillColor: '#4f46e5',
                                    fillOpacity: 0.5,
                                    radius: revenue * 10000
                                }).addTo(map)
                                .bindPopup(`<b>${country}</b><br>Revenue: $${loc.Revenue}M<br>Market Share: ${loc.MarketShare}`);
                            }
                        });

                        // Geographic Chart
                        new Chart(document.getElementById('geoChart'), {
                            type: 'doughnut',
                            data: {
                                labels: geoDataParsed.map(item => item.Country),
                                datasets: [{
                                    data: geoDataParsed.map(item => item.Revenue),
                                    backgroundColor: [
                                        '#4f46e5', '#6366f1', '#818cf8', '#a5b4fc', 
                                        '#c7d2fe', '#e0e7ff', '#ec4899', '#f472b6',
                                        '#f9a8d4', '#fce7f3'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: { position: 'right' },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: $${context.raw}M (${geoDataParsed[context.dataIndex].MarketShare})`;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Age Distribution Chart
                        new Chart(document.getElementById('ageChart'), {
                            type: 'pie',
                            data: {
                                labels: [...new Set(demoDataParsed.map(item => item.AgeGroup))],
                                datasets: [{
                                    data: [...new Set(demoDataParsed.map(item => item.AgeGroup))].map(age => 
                                        demoDataParsed.filter(d => d.AgeGroup === age)
                                            .reduce((sum, curr) => sum + parseFloat(curr.Percentage), 0)
                                    ),
                                    backgroundColor: [
                                        '#4f46e5', '#6366f1', '#818cf8', '#a5b4fc', '#c7d2fe'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: ${context.raw}% of customers`;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Gender Revenue Chart
                        new Chart(document.getElementById('genderChart'), {
                            type: 'bar',
                            data: {
                                labels: [...new Set(demoDataParsed.map(item => item.Gender))],
                                datasets: [{
                                    label: 'Revenue Contribution %',
                                    data: [...new Set(demoDataParsed.map(item => item.Gender))].map(gender => 
                                        demoDataParsed.filter(d => d.Gender === gender)
                                            .reduce((sum, curr) => sum + parseFloat(curr.RevenueContribution), 0)
                                    ),
                                    backgroundColor: ['#4f46e5', '#ec4899']
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });

                        // Product Category Chart
                        new Chart(document.getElementById('productChart'), {
                            type: 'polarArea',
                            data: {
                                labels: [...new Set(productDataParsed.map(item => item.ProductCategory))],
                                datasets: [{
                                    data: [...new Set(productDataParsed.map(item => item.ProductCategory))].map(cat => 
                                        productDataParsed.filter(p => p.ProductCategory === cat)
                                            .reduce((sum, curr) => sum + parseFloat(curr.Revenue), 0)
                                    ),
                                    backgroundColor: [
                                        '#4f46e5', '#6366f1', '#818cf8', '#a5b4fc'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: { position: 'right' }
                                }
                            }
                        });

                        // Profit Margin Chart
                        new Chart(document.getElementById('marginChart'), {
                            type: 'radar',
                            data: {
                                labels: productDataParsed.map(item => item.SubCategory),
                                datasets: [{
                                    label: 'Profit Margin %',
                                    data: productDataParsed.map(item => item.ProfitMargin.replace('%','')),
                                    backgroundColor: 'rgba(79, 70, 229, 0.2)',
                                    borderColor: 'rgba(79, 70, 229, 1)',
                                    pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                                    pointBorderColor: '#fff',
                                    pointHoverBackgroundColor: '#fff',
                                    pointHoverBorderColor: 'rgba(79, 70, 229, 1)'
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    r: {
                                        angleLines: { display: true },
                                        suggestedMin: 0,
                                        suggestedMax: 50
                                    }
                                }
                            }
                        });

                        // Helper function for map coordinates
                        function getCountryCoordinates(country) {
                            const coords = {
                                'United States': [37.0902, -95.7129],
                                'Canada': [56.1304, -106.3468],
                                'United Kingdom': [55.3781, -3.4360],
                                'Germany': [51.1657, 10.4515],
                                'France': [46.2276, 2.2137],
                                'China': [35.8617, 104.1954],
                                'Japan': [36.2048, 138.2529],
                                'Brazil': [-14.2350, -51.9253],
                                'Australia': [-25.2744, 133.7751],
                                'South Africa': [-30.5595, 22.9375]
                            };
                            return coords[country] || null;
                        }
                    }
                }, 100);
            }

            function handleFirstInteraction() {
                if (!firstInteraction) {
                    firstInteraction = true;
                    // Change layout to split screen
                    mainContainer.classList.remove('flex-col');
                    mainContainer.classList.add('flex-row');
                    chatContainer.classList.add('w-1/2');
                    dashboardContainer.classList.remove('hidden');
                    dashboardContainer.classList.add('w-1/2');
                    
                    // Render dashboards
                    renderDashboards();
                    
                    // Add message
                    setTimeout(() => {
                        addMessage("Here are the financial dashboards based on Amazon's performance data:", false);
                    }, 500);
                }
            }

            sendBtn.addEventListener('click', function() {
                const message = userInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    userInput.value = '';
                    
                    // Simulate bot response
                    setTimeout(() => {
                        addMessage("Analyzing Amazon financial data and generating dashboards...", false);
                        handleFirstInteraction();
                    }, 1000);
                }
            });

            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendBtn.click();
                }
            });

            // Initial bot message
            setTimeout(() => {
                addMessage("Hello! I can show you Amazon's financial performance data. Ask me anything about their stock, revenue, or ROI.", false);
            }, 500);
        });
    </script>
</body>
</html>
